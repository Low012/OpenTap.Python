(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{268:function(t,a,e){t.exports=e.p+"assets/img/python_package_in_tap.b9558dd0.png"},290:function(t,a,e){"use strict";e.r(a);var s=e(13),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"creating-an-opentap-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-an-opentap-plugin"}},[t._v("#")]),t._v(" Creating an OpenTAP plugin")]),t._v(" "),a("p",[t._v("Python development is done in modules (.py files) that reside in a Python package folder.\nEach module contains the code for one or more OpenTAP plugins.")]),t._v(" "),a("h2",{attrs:{id:"creating-a-basic-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-basic-plugin"}},[t._v("#")]),t._v(" Creating a Basic Plugin")]),t._v(" "),a("p",[t._v("In the following steps, "),a("em",[t._v("PythonExample")]),t._v(" refers to your project folder. Follow these steps to create a Python plugin:")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Create Python modules for your plugins. To start from scratch, develop your code in a folder within "),a("strong",[t._v("%TAP_PATH%\\Packages\\")]),t._v(". To begin with the Python package build:")]),t._v(" "),a("p",[t._v("a. Go to $TAP_PATH/Packages/ and make a new folder with the desired plugin name. This has to be a valid Python module name.")])]),t._v(" "),a("li",[a("p",[t._v("Add a python file to your folder containing your code. For example:")]),t._v(" "),a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Packages/MyPythonProject/step1.py")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" opentap\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Step1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opentap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TestStep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__init__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Step1 Executed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Test your plugin in OpenTAP and modify your code as needed. Rebuild the plugin if you add new types or properties to the plugin types.")])]),t._v(" "),a("li",[a("p",[t._v("When the package is complete and ready for distribution, you can create a .TapPackage file.")]),t._v(" "),a("p",[t._v("To do this, you need to add a package.xml file to the project.\nFor an example of this see the "),a("a",{attrs:{href:"https://raw.githubusercontent.com/opentap/OpenTap.Python/dev/OpenTap.Python.Examples/package.xml",target:"_blank",rel:"noopener noreferrer"}},[t._v("package.xml"),a("OutboundLink")],1),t._v(" used to build the PythonExamples project.")]),t._v(" "),a("p",[t._v("When you have the package.xml run:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('tap package create "Packages/MyPythonProject/package.xml\n')])])]),a("p",[t._v("This should result in a TapPackage file containing your python files, ready for distribution.")])])]),t._v(" "),a("p",[t._v("Your plugin package is complete and ready for distribution. When viewed in OpenTAP Package Manager, users will be able to see and install your package.")]),t._v(" "),a("p",[a("img",{attrs:{src:e(268),alt:""}})]),t._v(" "),a("h2",{attrs:{id:"adding-pip-package-dependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-pip-package-dependencies"}},[t._v("#")]),t._v(" Adding Pip Package Dependencies")]),t._v(" "),a("p",[t._v("The Python ecosystem has it's own package system for managing packages that you might need in your project.\nBy adding a requirements file, you can let the OpenTAP package system know that you need some pip packages installed\nas well as your OpenTap package.")]),t._v(" "),a("p",[t._v("For example numpy is a popular package for data processing.")]),t._v(" "),a("p",[t._v("Let's say we want to make sure that numpy is installed when our TapPackage is installed.")]),t._v(" "),a("ol",[a("li",[t._v("First create a "),a("code",[t._v("requirements.txt")]),t._v(" inside your plugin project. This could look like this"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("   numpy>1.23\n")])])])]),t._v(" "),a("li",[t._v("Add the requirements.txt file to your package.xml file:"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\x3c!-- ... --\x3e\n<File Path="Packages/PythonExamples/requirements.txt">\n  <PythonRequirements/> \x3c!-- this defines pip dependencies --\x3e\n</File>\n\x3c!-- ... --\x3e\n')])])])]),t._v(" "),a("li",[t._v("Build your package as usual.")])]),t._v(" "),a("p",[t._v("When you install your package, the Pip dependencies will now also be installed in your python path.")]),t._v(" "),a("h2",{attrs:{id:"projects-outside-the-opentap-installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#projects-outside-the-opentap-installation"}},[t._v("#")]),t._v(" Projects Outside the OpenTAP Installation")]),t._v(" "),a("p",[t._v("It is possible to create projects outside the OpenTAP installation folder, although it can give issues with packaging and project discovery.")]),t._v(" "),a("p",[t._v("First, it is necessesary to add an additional search path in the Python settings. This can be done through the settings or by using a command line action:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add a python-projects folder to the search paths.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# inside python-projects there can be a number of modules each defining a plugin module.")]),t._v("\ntap python search-path "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--add")]),t._v(" /home/user/code/python-projects/\n")])])]),a("p",[t._v("After doing this, OpenTAP should be able to locate the plugins defined inside that folder structure.\nThe folder structure can contain many sub-folders with projects.")]),t._v(" "),a("p",[t._v("This will cause a problem when you want to create a TapPackage file. TapPackage files tries to install the plugin into the OpenTAP installation folder structure and in theory this is not a problem.\nThe only problem is that your added search-path projects does not map directly to the way projects are set up inside the OpenTAP installation folder structure.\nThis can be fixed by using the "),a("code",[t._v("<ProjectFile/>")]),t._v(" element in your package XML file. Take for example this package XML:")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("python-test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("xmlns")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://keysight.com/Schemas/tap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Version")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("$(GitVersion)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("OS")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Windows,Linux,MacOS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Description of your package."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("PackageDependency")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Package")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("OpenTAP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Version")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("^9.18.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("PackageDependency")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Package")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Version")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("^3.0.0-beta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("File")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Path")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("python-test1/*.py"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ProjectFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- these files should be moved into Packages/python-test1/*.py --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("File")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("Path")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("requirements.txt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("PythonRequirements")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- This file should be moved to Packages/python-test1/requirements.txt --\x3e")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ProjectFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[a("code",[t._v("ProjectFile")]),t._v(" does either:")]),t._v(" "),a("ol",[a("li",[t._v("If the file name starts with the project name, prepend "),a("code",[t._v("Packages/")]),t._v(".")]),t._v(" "),a("li",[t._v("If the file name does not start with the project name, prepend "),a("code",[t._v("Packages/[project name]")]),t._v(".")])]),t._v(" "),a("p",[t._v("If this is not wanted, simply omit the ProjectFile element.")]),t._v(" "),a("p",[t._v("So, the python-projects folder might look something like this:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/home/user/code/python-projects/\n                           plugin1/\n                              step.py\n                              step2.py\n                              package.xml\n                              requirements.txt\n                           plugin2/\n                              instrument.py\n                              package.xml\n                              requirements.txt\n")])])]),a("p",[t._v("However, when plugin1.TapPackage and plugin2.TapPackage, these will get deployed into the OpenTAP folder as such:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/opentap-installation/\n    Dependencies/...\n    Packages/\n       plugin1/\n           step.py\n           step2.py\n           package.xml\n           requirements.txt\n       plugin2/\n           instrument.py\n           package.xml\n           requirements.txt\n       ....\n    SessionLogs/...\n    Settings/...\n    tap.exe\n    OpenTap.dll\n    ...\n")])])]),a("p",[t._v("In either scenario, OpenTAP will be able to find them due to their location with respect to the search path.")]),t._v(" "),a("p",[a("em",[t._v("Warning:")]),t._v(" If you set the search path and install the TapPackage plugin in the same installation it is undefined what happens.\nIt is recommended to remove the search path when installing the TapPackage for a given Python-based plugin.")])])}),[],!1,null,null,null);a.default=n.exports}}]);